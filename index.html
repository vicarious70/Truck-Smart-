<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trucking Made Simple</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin: 12px 0; }
    label { display:block; font-size: 12px; margin-top: 8px; }
    input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: 10px 12px; border-radius: 10px; border: 1px solid #888; background: #fff; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align:left; padding: 8px; border-bottom: 1px solid #eee; vertical-align: top; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .muted { color:#666; font-size: 12px; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    @media print {
      .no-print { display:none !important; }
      body { margin: 0; }
      .card { border: none; }
    }
  </style>
</head>
<body>
  <header class="no-print">
    <div>
      <h2 style="margin:0;">Trucking Made Simple</h2>
      <div class="muted">Billing + invoices (saved on this device). Export regularly for backup.</div>
    </div>
    <div class="actions">
      <button id="printInvoiceBtn" disabled>Print Invoice</button>
      <button id="exportBtn">Export Data</button>
      <input id="importFile" type="file" accept="application/json" style="display:none;" />
      <button id="importBtn">Import Data</button>
      <button id="clearBtn">Clear (This Device)</button>
    </div>
  </header>

  <div class="card no-print">
    <h3 style="margin-top:0;">Company Settings (prints on invoices)</h3>

    <div class="row">
      <div>
        <label>Company Name</label>
        <input id="bizName" placeholder="Trucking Made Simple LLC" />
      </div>
      <div>
        <label>Phone</label>
        <input id="bizPhone" placeholder="(555) 555-5555" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Email</label>
        <input id="bizEmail" placeholder="billing@yourcompany.com" />
      </div>
      <div>
        <label>Invoice Terms (example: Net 7)</label>
        <input id="bizTerms" placeholder="Net 7" />
      </div>
    </div>

    <label>Address (prints on invoices)</label>
    <textarea id="bizAddress" rows="3" placeholder="Street&#10;City, State ZIP"></textarea>

    <label>Payment Instructions (prints on invoices)</label>
    <textarea id="bizPay" rows="3" placeholder="Make checks payable to...&#10;ACH: Bank / Routing / Account&#10;Or any instructions you want"></textarea>

    <div style="margin-top:10px;" class="actions">
      <button id="saveBizBtn">Save Company Info</button>
    </div>
    <div class="muted" style="margin-top:6px;">
      Note: Company info saves on THIS device. If you use another device, you’ll enter it again.
    </div>
  </div>

  <div class="card no-print">
    <h3 style="margin-top:0;">Add Load</h3>
    <div class="row">
      <div>
        <label>Customer</label>
        <input id="customer" placeholder="ABC Logistics" />
      </div>
      <div>
        <label>Load / Trip #</label>
        <input id="loadNo" placeholder="L-1001" />
      </div>
    </div>
<div class="row">
  <div>
    <label>Shipper (Company Name)</label>
    <input id="shipperName" placeholder="ABC Warehouse" />
  </div>
  <div>
    <label>Consignee (Company Name)</label>
    <input id="consigneeName" placeholder="XYZ Distribution" />
  </div>
</div>

<label>Shipper Address</label>
<textarea id="shipperAddress" rows="2" placeholder="Street&#10;City, State ZIP"></textarea>

<label>Consignee Address</label>
<textarea id="consigneeAddress" rows="2" placeholder="Street&#10;City, State ZIP"></textarea>
    <div class="row">
      <div>
        <label>Pickup (City, ST)</label>
        <input id="pickup" placeholder="Dallas, TX" />
      </div>
      <div>
        <label>Delivery (City, ST)</label>
        <input id="delivery" placeholder="Atlanta, GA" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Pickup Date</label>
        <input id="pickupDate" type="date" />
      </div>
      <div>
        <label>Delivery Date</label>
        <input id="deliveryDate" type="date" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Rate ($)</label>
        <input id="rate" type="number" step="0.01" placeholder="2500.00" />
      </div>
      <div>
        <label>Invoice #</label>
        <input id="invoiceNo" placeholder="INV-1001" />
      </div>
    </div>

    <label>Notes (prints on invoice)</label>
    <textarea id="notes" rows="3" placeholder="Any notes for this load..."></textarea>

    <div style="margin-top:10px;" class="actions">
      <button id="addBtn">Save Load</button>
    </div>
  </div>

  <div class="card no-print">
    <h3 style="margin-top:0;">Loads</h3>
    <table>
      <thead>
        <tr>
          <th>Invoice</th>
          <th>Customer</th>
          <th>Route</th>
          <th>Rate</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="loadsTbody"></tbody>
    </table>
  </div>

  <div class="card" id="invoiceCard" style="display:none;">
    <h2 style="margin-top:0;">Invoice</h2>
    <div class="muted" id="invMeta"></div>
    <hr />
    <div id="invBody"></div>
    <hr />
    <h3 style="margin:0;">Total Due: <span id="invTotal"></span></h3>
    <div class="muted">Tip: On mobile, use your browser menu → Print → Save as PDF.</div>
  </div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const KEY = "tms_loads_v1";
  const COMPANY_KEY = "tms_company_v1";

  function loadData() {
    try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch { return []; }
  }
  function saveData(items) {
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  function loadCompany() {
    try { return JSON.parse(localStorage.getItem(COMPANY_KEY) || "{}"); }
    catch { return {}; }
  }
  function saveCompany(c) {
    localStorage.setItem(COMPANY_KEY, JSON.stringify(c));
  }

  function money(n) {
    const x = Number(n || 0);
    return x.toLocaleString(undefined, { style: "currency", currency: "USD" });
  }

  function escapeHtml(s) {
    return String(s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  let loads = loadData();
  let company = loadCompany();
  let selectedId = null;

  const els = {
    loadsTbody: document.getElementById("loadsTbody"),
    invoiceCard: document.getElementById("invoiceCard"),
    invMeta: document.getElementById("invMeta"),
    invBody: document.getElementById("invBody"),
    invTotal: document.getElementById("invTotal"),
    printInvoiceBtn: document.getElementById("printInvoiceBtn"),
    exportBtn: document.getElementById("exportBtn"),
    importBtn: document.getElementById("importBtn"),
    importFile: document.getElementById("importFile"),
    clearBtn: document.getElementById("clearBtn"),
    addBtn: document.getElementById("addBtn"),
    saveBizBtn: document.getElementById("saveBizBtn"),
  };

  function fillCompanyForm() {
    document.getElementById("bizName").value = company.bizName || "";
    document.getElementById("bizPhone").value = company.bizPhone || "";
    document.getElementById("bizEmail").value = company.bizEmail || "";
    document.getElementById("bizTerms").value = company.bizTerms || "";
    document.getElementById("bizAddress").value = company.bizAddress || "";
    document.getElementById("bizPay").value = company.bizPay || "";
  }

  function renderLoads() {
    els.loadsTbody.innerHTML = "";
    if (!loads.length) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="5" class="muted">No loads yet. Add one above.</td>`;
      els.loadsTbody.appendChild(tr);
      return;
    }
    loads.forEach(l => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(l.invoiceNo || "")}</td>
        <td>${escapeHtml(l.customer || "")}</td>
        <td>${escapeHtml(l.pickup || "")} → ${escapeHtml(l.delivery || "")}</td>
        <td>${money(l.rate)}</td>
        <td class="actions">
          <button data-action="view" data-id="${l.id}">View Invoice</button>
          <button data-action="delete" data-id="${l.id}">Delete</button>
        </td>
      `;
      els.loadsTbody.appendChild(tr);
    });
  }

  function showInvoice(id) {
    const l = loads.find(x => x.id === id);
    if (!l) return;
    selectedId = id;

    els.invoiceCard.style.display = "block";
    els.printInvoiceBtn.disabled = false;

    els.invMeta.textContent = `Invoice #${l.invoiceNo || ""} • Load ${l.loadNo || ""}`;

    const companyBlock = `
      <div style="margin-bottom:10px;">
        <div><b>${escapeHtml(company.bizName || "Trucking Made Simple")}</b></div>
        <div>${escapeHtml(company.bizAddress || "").replaceAll("\n","<br/>")}</div>
        <div>${escapeHtml(company.bizPhone || "")}${company.bizPhone && company.bizEmail ? " • " : ""}${escapeHtml(company.bizEmail || "")}</div>
        <div>${company.bizTerms ? "<b>Terms:</b> " + escapeHtml(company.bizTerms) : ""}</div>
      </div>
    `;

    const paymentBlock = company.bizPay
      ? `<p><b>Payment Instructions:</b><br/>${escapeHtml(company.bizPay).replaceAll("\n","<br/>")}</p>`
      : "";

    els.invBody.innerHTML = `
      ${companyBlock}
      <p><b>Bill To:</b> ${escapeHtml(l.customer || "")}</p>
      <p><b>Route:</b> ${escapeHtml(l.pickup || "")} → ${escapeHtml(l.delivery || "")}</p>
      <p><b>Pickup Date:</b> ${escapeHtml(l.pickupDate || "")}<br/>
         <b>Delivery Date:</b> ${escapeHtml(l.deliveryDate || "")}</p>
      <p><b>Notes:</b><br/>${escapeHtml(l.notes || "").replaceAll("\n","<br/>")}</p>
      ${paymentBlock}
    `;
    els.invTotal.textContent = money(l.rate);
    window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
  }

  // Button wiring
  els.saveBizBtn.addEventListener("click", () => {
    company = {
      bizName: document.getElementById("bizName").value.trim(),
      bizPhone: document.getElementById("bizPhone").value.trim(),
      bizEmail: document.getElementById("bizEmail").value.trim(),
      bizTerms: document.getElementById("bizTerms").value.trim(),
      bizAddress: document.getElementById("bizAddress").value.trim(),
      bizPay: document.getElementById("bizPay").value.trim(),
    };
    saveCompany(company);
    alert("Company info saved on this device.");
  });

  els.addBtn.addEventListener("click", () => {
    const l = {shipperName: document.getElementById("shipperName").value.trim(),
shipperAddress: document.getElementById("shipperAddress").value.trim(),
consigneeName: document.getElementById("consigneeName").value.trim(),
consigneeAddress: document.getElementById("consigneeAddress").value.trim(),
      id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
      customer: document.getElementById("customer").value.trim(),
      loadNo: document.getElementById("loadNo").value.trim(),
      pickup: document.getElementById("pickup").value.trim(),
      delivery: document.getElementById("delivery").value.trim(),
      pickupDate: document.getElementById("pickupDate").value,
      deliveryDate: document.getElementById("deliveryDate").value,
      rate: document.getElementById("rate").value,
      invoiceNo: document.getElementById("invoiceNo").value.trim(),
      notes: document.getElementById("notes").value.trim(),
      createdAt: new Date().toISOString()
    };

    loads.unshift(l);
    saveData(loads);
    renderLoads();

    ["customer","loadNo","pickup","delivery","pickupDate","deliveryDate","rate","invoiceNo","notes"]
      .forEach(id => document.getElementById(id).value = "");

    alert("Saved.");
  });

  els.loadsTbody.addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const id = btn.getAttribute("data-id");
    const action = btn.getAttribute("data-action");

    if (action === "view") showInvoice(id);

    if (action === "delete") {
      if (!confirm("Delete this load?")) return;
      loads = loads.filter(x => x.id !== id);
      saveData(loads);

      if (selectedId === id) {
        els.invoiceCard.style.display = "none";
        els.printInvoiceBtn.disabled = true;
      }
      renderLoads();
    }
  });

  els.printInvoiceBtn.addEventListener("click", () => {
    if (!selectedId) return;
    window.print();
  });

  els.exportBtn.addEventListener("click", () => {
    const payload = { version: 1, exportedAt: new Date().toISOString(), loads };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "trucking-made-simple-data.json";
    a.click();
    URL.revokeObjectURL(url);
  });

  els.importBtn.addEventListener("click", () => {
    els.importFile.click();
  });

  els.importFile.addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const text = await file.text();
    try {
      const parsed = JSON.parse(text);
      const incoming = Array.isArray(parsed) ? parsed : (parsed.loads || []);
      if (!Array.isArray(incoming)) throw new Error("Bad format");
      loads = incoming;
      saveData(loads);
      renderLoads();
      alert("Imported.");
    } catch {
      alert("Import failed. Make sure you selected the exported JSON file.");
    } finally {
      e.target.value = "";
    }
  });

  els.clearBtn.addEventListener("click", () => {
    if (!confirm("Clear all loads on this device?")) return;
    loads = [];
    saveData(loads);
    els.invoiceCard.style.display = "none";
    els.printInvoiceBtn.disabled = true;
    renderLoads();
  });

  // init
  fillCompanyForm();
  renderLoads();
});
</script>
</body>
</html>
